"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8811],{8811:(k,p,s)=>{s.r(p),s.d(p,{ChatPageModule:()=>S});var g=s(177),u=s(4341),r=s(4742),m=s(9384),h=s(467),e=s(4438),C=s(2872),c=s(2784);let M=(()=>{var n;class o{constructor(){this.firestore=(0,c.aU)()}getMessagesByChatId(t){var a=this;return(0,h.A)(function*(){const d=(0,c.H9)(a.firestore,`chats/${t}`),l=yield(0,c.x7)(d);if(l.exists()){const f=l.data();return(null==f?void 0:f.messages)||[]}return[]})()}sendMessage(t){var a=this;return(0,h.A)(function*(){const d=(0,c.H9)(a.firestore,`chats/${t.chatId}`);(yield(0,c.x7)(d)).exists()?yield(0,c.mZ)(d,{messages:(0,c.hq)(t)}):yield(0,c.BN)(d,{createdAt:(new Date).toISOString(),id:t.chatId,users:[t.sender],messages:[t]})})()}}return(n=o).\u0275fac=function(t){return new(t||n)},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),o})();var v=s(5504),x=(s(7852),s(1076),s(8041),s(1362),s(5312)),y=s(2214);const P=(n,o)=>({sent:n,received:o});function I(n,o){if(1&n&&(e.j41(0,"ion-chip")(1,"ion-label",9),e.EFF(2),e.k0s(),e.j41(3,"p",10),e.EFF(4),e.k0s(),e.j41(5,"ion-label",11),e.EFF(6),e.k0s()()),2&n){const i=e.XpG().$implicit;e.R7$(2),e.JRh(i.fromName||"..."),e.R7$(2),e.JRh(i.content),e.R7$(2),e.JRh(i.timestamp)}}function R(n,o){if(1&n&&(e.j41(0,"div",7),e.DNE(1,I,7,3,"ion-chip",8),e.k0s()),2&n){const i=o.$implicit,t=e.XpG();e.Y8G("ngClass",e.l_i(2,P,i.sender===t.currentUserId,i.sender!==t.currentUserId)),e.R7$(),e.Y8G("ngIf",i.sender)}}const b=(0,y.Wp)(x.c.firebaseConfig),w=(0,c.aU)(b),F=[{path:"",component:(()=>{var n;class o{constructor(){this.messages=[],this.newMessage="",this.currentUserId="",this.messageService=(0,e.WQX)(M),this.activatedRoute=(0,e.WQX)(m.nX),this.platform=(0,e.WQX)(C.OD)}ngOnInit(){this.chatId=this.activatedRoute.snapshot.paramMap.get("id");const t=(0,v.o)().currentUser;t&&(this.currentUserId=t.uid),this.loadMessages()}loadMessages(){var t=this;return(0,h.A)(function*(){t.messages=yield t.messageService.getMessagesByChatId(t.chatId);for(const a of t.messages){console.log(a);const d=(0,c.H9)(w,`users/${a.sender}`),l=yield(0,c.x7)(d);l.exists()&&(a.fromName=l.data().username)}})()}sendMessage(){var t=this;return(0,h.A)(function*(){if(""===t.newMessage.trim())return;const a={id:Date.now().toString(),chatId:t.chatId,content:t.newMessage,sender:t.currentUserId,timestamp:(new Date).toISOString()};yield t.messageService.sendMessage(a),t.messages.push(a),t.newMessage=""})()}getBackButtonText(){return this.platform.is("ios")?"Inbox":""}}return(n=o).\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-chat"]],decls:15,vars:5,consts:[[3,"translucent"],["slot","start"],["defaultHref","/",3,"text"],[3,"fullscreen"],[3,"ngClass",4,"ngFor","ngForOf"],["placeholder","Digite sua mensagem",3,"ngModelChange","ngModel"],["fill","solid",3,"click"],[3,"ngClass"],[4,"ngIf"],[2,"display","block","text-align","start","font-size","medium","font-weight","bold"],[2,"display","block","margin","5px 0"],[2,"display","block","text-align","end","font-size","smaller"]],template:function(t,a){1&t&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e.nrm(3,"ion-back-button",2),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Chat"),e.k0s()()(),e.j41(6,"ion-content",3)(7,"div"),e.DNE(8,R,2,5,"div",4),e.k0s(),e.j41(9,"ion-footer")(10,"ion-toolbar")(11,"ion-item")(12,"ion-input",5),e.mxI("ngModelChange",function(l){return e.DH7(a.newMessage,l)||(a.newMessage=l),l}),e.k0s(),e.j41(13,"ion-button",6),e.bIt("click",function(){return a.sendMessage()}),e.EFF(14,"Enviar"),e.k0s()()()()()),2&t&&(e.Y8G("translucent",!0),e.R7$(3),e.Y8G("text",a.getBackButtonText()),e.R7$(3),e.Y8G("fullscreen",!0),e.R7$(2),e.Y8G("ngForOf",a.messages),e.R7$(4),e.R50("ngModel",a.newMessage))},dependencies:[g.YU,g.Sq,g.bT,u.BC,u.vS,r.Jm,r.QW,r.ZB,r.W9,r.M0,r.eU,r.$w,r.uz,r.he,r.BC,r.ai,r.Gw,r.el],styles:['@charset "UTF-8";.sent[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-bottom:5px;margin-top:5px;margin-right:10px}.sent[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]{background-color:#f1f0f0;color:#000;padding:10px;border-radius:15px;max-width:70%;word-wrap:break-word;text-align:left;display:inline-block}.received[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;margin-bottom:5px;margin-top:5px;margin-left:10px}.received[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]{background-color:#f1f0f0;color:#000;padding:10px;border-radius:15px;max-width:70%;word-wrap:break-word;text-align:left;display:inline-block}ion-item[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%;padding:0}ion-label[_ngcontent-%COMP%]{display:block;width:auto;max-width:100%;word-wrap:break-word}ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:12px;color:gray}ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:14px}']}),o})()}];let O=(()=>{var n;class o{}return(n=o).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[m.iI.forChild(F),m.iI]}),o})(),S=(()=>{var n;class o{}return(n=o).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[g.MD,u.YN,r.bv,O]}),o})()}}]);