"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[200],{200:($,m,c)=>{c.r(m),c.d(m,{ListChatsPageModule:()=>I});var d=c(177),p=c(4341),a=c(4742),g=c(9384),f=c(467),t=c(4438),v=c(6340),L=c(1339);const M=e=>["/chat",e];function P(e,i){if(1&e&&(t.j41(0,"ion-item",8),t.nrm(1,"ion-icon",9),t.j41(2,"ion-label")(3,"h2"),t.EFF(4),t.k0s(),t.j41(5,"ion-note"),t.EFF(6),t.nI1(7,"date"),t.k0s()()()),2&e){const o=i.$implicit,s=i.index,n=t.XpG(2);t.Y8G("routerLink",t.eq3(6,M,o.id)),t.R7$(4),t.JRh(n.matchMessages[s]),t.R7$(2),t.JRh(t.i5U(7,3,null==o.lastMessage?null:o.lastMessage.timestamp,"short"))}}function y(e,i){if(1&e&&(t.j41(0,"ion-list"),t.DNE(1,P,8,8,"ion-item",7),t.k0s()),2&e){const o=t.XpG();t.R7$(),t.Y8G("ngForOf",o.chats)}}function F(e,i){1&e&&(t.j41(0,"div",10)(1,"h2"),t.EFF(2,"Nenhum chat iniciado ainda."),t.k0s()())}const R=[{path:"",component:(()=>{var e;class i{constructor(){this.firestore=(0,t.WQX)(v.Qe),this.authService=(0,t.WQX)(L.u),this.chats=[],this.matchMessages=[],this.userCache={},this.userUid=null}ngOnInit(){this.authService.getCurrentUserId().then(s=>{this.userUid=s,s&&this.loadChats()})}loadChats(){var s=this;this.firestore.collection("chats",n=>n.where("users","array-contains",this.userUid)).snapshotChanges().subscribe(function(){var n=(0,f.A)(function*(r){s.chats=yield Promise.all(r.map(function(){var l=(0,f.A)(function*(u){var h;const C=yield s.getUserDetails(u.payload.doc.data().users),U=yield s.getMatchMessage(C);return s.matchMessages.push(U),{id:u.payload.doc.id,users:C,lastMessage:(null===(h=u.payload.doc.data().messages)||void 0===h?void 0:h.slice(-1)[0])||null}});return function(u){return l.apply(this,arguments)}}()))});return function(r){return n.apply(this,arguments)}}())}getUserDetails(s){var n=this;return(0,f.A)(function*(){const r=[];for(const l of s){if(!n.userCache[l]){const u=yield n.firestore.collection("users").doc(l).get().toPromise();if(null!=u&&u.exists){const h=u.data();n.userCache[l]={uid:l,username:h.username}}}r.push(n.userCache[l])}return r})()}getMatchMessage(s){var n=this;return(0,f.A)(function*(){if(2===s.length&&n.userUid){const r=s.find(l=>l.uid!==n.userUid);if(r)return`Voc\xea formou um match com ${r.username}!`}return"Match com mais usu\xe1rios"})()}refresh(s){setTimeout(()=>{s.detail.complete()},1e3)}getChatList(){return this.chats}}return(e=i).\u0275fac=function(s){return new(s||e)},e.\u0275cmp=t.VBU({type:e,selectors:[["app-list-chats"]],decls:14,vars:4,consts:[["noChats",""],[3,"translucent"],[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],["collapse","condense"],["size","large"],[4,"ngIf","ngIfElse"],[3,"routerLink",4,"ngFor","ngForOf"],[3,"routerLink"],["name","chatbubbles-outline","slot","start"],[1,"ion-padding"]],template:function(s,n){if(1&s){const r=t.RV6();t.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-title"),t.EFF(3,"Inbox"),t.k0s()()(),t.j41(4,"ion-content",2)(5,"ion-refresher",3),t.bIt("ionRefresh",function(u){return t.eBV(r),t.Njj(n.refresh(u))}),t.nrm(6,"ion-refresher-content"),t.k0s(),t.j41(7,"ion-header",4)(8,"ion-toolbar")(9,"ion-title",5),t.EFF(10,"Conversas"),t.k0s()()(),t.DNE(11,y,2,1,"ion-list",6)(12,F,3,0,"ng-template",null,0,t.C5r),t.k0s()}if(2&s){const r=t.sdS(13);t.Y8G("translucent",!0),t.R7$(4),t.Y8G("fullscreen",!0),t.R7$(7),t.Y8G("ngIf",n.chats.length>0)("ngIfElse",r)}},dependencies:[d.Sq,d.bT,a.W9,a.eU,a.iq,a.uz,a.he,a.nf,a.JI,a.To,a.Ki,a.BC,a.ai,a.N7,g.Wk,d.vh]}),i})()}];let j=(()=>{var e;class i{}return(e=i).\u0275fac=function(s){return new(s||e)},e.\u0275mod=t.$C({type:e}),e.\u0275inj=t.G2t({imports:[g.iI.forChild(R),g.iI]}),i})(),I=(()=>{var e;class i{}return(e=i).\u0275fac=function(s){return new(s||e)},e.\u0275mod=t.$C({type:e}),e.\u0275inj=t.G2t({imports:[d.MD,p.YN,a.bv,j]}),i})()}}]);